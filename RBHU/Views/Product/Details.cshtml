@model RBHU_DbServices.Models.Product
@{
    ViewData["Title"] = "Product Details";
    Layout = "";
}

<link rel="icon" type="image/x-icon" href="~/images/as_logo.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<div class="details-container">
    <!-- Header -->
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h4 class="mb-1"><i class="fas fa-eye me-2"></i>Product Details</h4>
                <p class="text-muted mb-0 small">View detailed product information</p>
            </div>
            <div class="d-flex gap-2">
                <a href="@Url.Action("Index", "Product")" class="btn btn-sm btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i><span class="btn-text">Back</span>
                </a>
                <a href="@Url.Action("Edit", "Product", new { id = Model.Id })" class="btn btn-sm btn-warning">
                    <i class="fas fa-edit me-1"></i><span class="btn-text">Edit</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Product Details Card -->
    <div class="row">
        <div class="col-lg-5 col-md-12">
            <!-- Product Image -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-image me-2"></i>Product Image</h5>
                </div>
                <div class="card-body text-center">
                    @if (!string.IsNullOrEmpty(Model.ImageUrl))
                    {
                        <img src="@Model.ImageUrl" alt="@Model.Name" class="img-fluid rounded shadow product-image" />
                    }
                    else
                    {
                        <div class="empty-image-placeholder">
                            <div class="text-center">
                                <i class="fas fa-image fa-4x text-muted mb-3"></i>
                                <p class="text-muted">No image available</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-7 col-md-12">
            <!-- Product Information -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Product Information</h5>
                </div>
                <div class="card-body">
                    <!-- Product Name -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Product Name:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            <h4 class="text-primary mb-0">@Model.Name</h4>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Description:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            @if (!string.IsNullOrEmpty(Model.Description))
                            {
                                <p class="mb-0">@Model.Description</p>
                            }
                            else
                            {
                                <span class="text-muted">No description available</span>
                            }
                        </div>
                    </div>

                    <!-- Category -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Category:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            <span class="badge bg-primary fs-6">@Model.Category?.Name</span>
                        </div>
                    </div>

                    <!-- Regular Price -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Regular Price:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            <h5 class="text-success mb-0">₹@Model.Price.ToString("N2")</h5>
                        </div>
                    </div>

                    <!-- Offer Price -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Offer Price:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            @if (Model.OfferPrice > 0)
                            {
                                <div>
                                    <h5 class="text-danger mb-1">₹@Model.OfferPrice.ToString("N2")</h5>
                                    @{
                                        var discount = ((Model.Price - Model.OfferPrice) / Model.Price) * 100;
                                    }
                                    <span class="badge bg-success">@discount.ToString("F0")% OFF</span>
                                    <small class="text-muted ms-2">You save ₹@((Model.Price - Model.OfferPrice).ToString("N2"))</small>
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">No offer price</span>
                            }
                        </div>
                    </div>

                    <!-- Product ID -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Product ID:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            <code class="product-code">#@Model.Id</code>
                        </div>
                    </div>

                    <!-- Created Date -->
                    <div class="row mb-3">
                        <div class="col-sm-4 col-12">
                            <strong>Created Date:</strong>
                        </div>
                        <div class="col-sm-8 col-12">
                            @if (Model.CreatedAt.HasValue)
                            {
                                <div>
                                    <span>@Model.CreatedAt.Value.ToString("dd MMMM yyyy")</span>
                                    <small class="text-muted ms-2">at @Model.CreatedAt.Value.ToString("HH:mm")</small>
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">Not available</span>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price Comparison Card -->
            @if (Model.OfferPrice > 0)
            {
                <div class="card mt-4">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0"><i class="fas fa-tags me-2"></i>Price Breakdown</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="price-breakdown-item">
                                    <h6 class="text-muted mb-1">Regular Price</h6>
                                    <h5 class="text-secondary">₹@Model.Price.ToString("N2")</h5>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="price-breakdown-item">
                                    <h6 class="text-muted mb-1">Offer Price</h6>
                                    <h5 class="text-success">₹@Model.OfferPrice.ToString("N2")</h5>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="price-breakdown-item">
                                    <h6 class="text-muted mb-1">Customer will save</h6>
                                    <h5 class="text-danger">₹@((Model.Price - Model.OfferPrice).ToString("N2"))</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <!-- Action Buttons -->
            <div class="card mt-4">
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-6">
                            <button class="btn btn-outline-danger w-100" onclick="deleteProduct()">
                                <i class="fas fa-trash me-2"></i>Delete
                            </button>
                        </div>
                        <div class="col-6">
                            <a href="@Url.Action("Edit", "Product", new { id = Model.Id })" class="btn btn-warning w-100">
                                <i class="fas fa-edit me-2"></i>Edit
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
                    <h6>Are you sure you want to delete this product?</h6>
                    <p class="text-muted mb-3"><strong>@Model.Name</strong></p>
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This action cannot be undone. All product data will be permanently deleted.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDelete()">
                    <i class="fas fa-trash me-2"></i>Delete Product
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Theme Management
    function initTheme() {
        const savedTheme = localStorage.getItem('adminTheme') || 'light';
        applyTheme(savedTheme);
    }

    function applyTheme(theme) {
        document.body.setAttribute('data-theme', theme);
    }

    $(document).ready(function () {
        initTheme();

        // Listen for theme changes from parent dashboard
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'THEME_CHANGE') {
                applyTheme(event.data.theme);
            }
        });
    });

    function deleteProduct() {
        $('#deleteModal').modal('show');
    }

    function confirmDelete() {
        const confirmBtn = $('#confirmDeleteBtn');
        const originalText = confirmBtn.html();
        confirmBtn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-2"></i>Deleting...');

        $.ajax({
            url: '@Url.Action("DeleteProduct", "Product")',
            type: 'POST',
            data: { id: @Model.Id },
            success: function (response) {
                if (response.success) {
                    showAlert('Product deleted successfully!', 'success');
                    setTimeout(function () {
                        window.location.href = '@Url.Action("Index", "Product")';
                    }, 1500);
                } else {
                    confirmBtn.prop('disabled', false).html(originalText);
                    $('#deleteModal').modal('hide');
                    showAlert(response.message || 'Error deleting product.', 'danger');
                }
            },
            error: function () {
                confirmBtn.prop('disabled', false).html(originalText);
                $('#deleteModal').modal('hide');
                showAlert('An error occurred while deleting the product.', 'error');
            }
        });
    }

    function showAlert(message, type) {
        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;

        $('.alert').remove();
        $('.details-container').prepend(alertHtml);

        setTimeout(() => $('.alert').fadeOut('slow'), 5000);
    }
</script>

<style>
    :root {
        --bg-primary: #f5f7fa;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f8fafc;
        --text-primary: #2d3748;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;
        --border-color: #e2e8f0;
        --border-light: #f1f5f9;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
        --transition: all 0.3s ease;
    }

    [data-theme="dark"] {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-tertiary: #334155;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: #334155;
        --border-light: #475569;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.7);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
    }

    .details-container {
        padding: 24px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .page-header {
        background: var(--bg-secondary);
        padding: 24px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        margin-bottom: 20px;
    }

    .page-header h4 {
        color: var(--text-primary);
        font-weight: 700;
        font-size: 1.5rem;
    }

    .card {
        border: none;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        margin-bottom: 1rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
    }

    .card-header {
        background: var(--bg-tertiary);
        border-bottom: 1px solid var(--border-color);
        border-radius: 12px 12px 0 0 !important;
        font-weight: 600;
        padding: 16px 20px;
    }

    .card-header h5,
    .card-header h6 {
        color: var(--text-primary);
        margin: 0;
    }

    .card-header.bg-success {
        background: #10b981 !important;
        color: white !important;
        border-bottom: none;
    }

    .card-header.bg-success h6 {
        color: white !important;
    }

    .card-body {
        padding: 20px;
    }

    .empty-image-placeholder {
        background: var(--bg-tertiary);
        border-radius: 8px;
        padding: 60px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 300px;
    }

    .empty-image-placeholder i {
        color: var(--text-muted);
    }

    .product-image {
        max-height: 400px;
        transition: transform 0.3s ease;
    }

    .product-image:hover {
        transform: scale(1.02);
    }

    .shadow {
        box-shadow: var(--shadow-md) !important;
    }

    .row.mb-3 {
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-light);
    }

    .row.mb-3:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .text-primary {
        color: #3b82f6 !important;
    }

    .text-success {
        color: #10b981 !important;
    }

    .text-danger {
        color: #ef4444 !important;
    }

    .text-warning {
        color: #f59e0b !important;
    }

    .text-muted {
        color: var(--text-muted) !important;
    }

    .text-secondary {
        color: var(--text-secondary) !important;
    }

    h4.text-primary {
        font-weight: 600;
    }

    .badge {
        font-size: 0.85rem;
        padding: 6px 12px;
        font-weight: 600;
        border-radius: 6px;
    }

    .product-code {
        font-size: 0.9em;
        border-radius: 6px;
        padding: 4px 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .price-breakdown-item {
        padding: 12px;
        border-right: 1px solid var(--border-color);
    }

    .price-breakdown-item:last-child {
        border-right: none;
    }

    .btn {
        border-radius: 8px;
        font-weight: 500;
        padding: 10px 20px;
        transition: var(--transition);
        border: none;
    }

    .btn-sm {
        padding: 8px 16px;
        font-size: 0.85rem;
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn-secondary:hover {
        background: #4b5563;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .btn-warning {
        background: #f59e0b;
        color: white;
    }

    .btn-warning:hover {
        background: #d97706;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .btn-outline-danger {
        background: var(--bg-secondary);
        color: #ef4444;
        border: 2px solid #ef4444;
    }

    .btn-outline-danger:hover {
        background: #ef4444;
        color: white;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .btn-danger {
        background: #ef4444;
        color: white;
    }

    .btn-danger:hover {
        background: #dc2626;
    }

    .modal-content {
        border-radius: 12px;
        border: none;
        box-shadow: var(--shadow-lg);
        background: var(--bg-secondary);
        color: var(--text-primary);
    }

    .modal-header {
        border-bottom: 1px solid var(--border-color);
        padding: 16px 20px;
    }

    .modal-title {
        color: var(--text-primary);
    }

    .modal-body {
        padding: 24px;
    }

    .modal-footer {
        border-top: 1px solid var(--border-color);
        padding: 16px 20px;
    }

    [data-theme="dark"] .btn-close {
        filter: invert(1);
    }

    .alert {
        border-radius: 10px;
        border: none;
        padding: 14px 18px;
        box-shadow: var(--shadow-sm);
    }

    .alert-success {
        background: #d1fae5;
        color: #065f46;
    }

    .alert-danger {
        background: #fee2e2;
        color: #991b1b;
    }

    [data-theme="dark"] .alert-success {
        background: #064e3b;
        color: #d1fae5;
    }

    [data-theme="dark"] .alert-danger {
        background: #7f1d1d;
        color: #fecaca;
    }

    .fa-3x {
        font-size: 3em;
    }

    .fa-4x {
        font-size: 4em;
    }

    .fs-6 {
        font-size: 1rem !important;
    }

    .ms-2 {
        margin-left: 0.5rem !important;
    }

    .mb-1 {
        margin-bottom: 0.25rem !important;
    }

    .me-2 {
        margin-right: 0.5rem !important;
    }

    .w-100 {
        width: 100% !important;
    }

    /* Responsive - Matching Dashboard Style */
    @@media (max-width: 992px) {
        .col-lg-5,
        .col-lg-7 {
            width: 100%;
        }
    }

    @@media (max-width: 768px) {
        .details-container {
            padding: 16px 12px;
        }

        .page-header {
            padding: 16px;
        }

        .page-header h4 {
            font-size: 1.2rem;
        }

        .page-header h4 i {
            display: none;
        }

        .page-header p {
            font-size: 0.8rem;
        }

        .btn-text {
            display: none;
        }

        .btn-sm {
            padding: 6px 10px;
        }

        .card-body {
            padding: 16px;
        }

        .product-image {
            max-height: 250px !important;
        }

        .price-breakdown-item {
            border-right: none;
            border-bottom: 1px solid var(--border-color);
            padding: 12px;
        }

        .price-breakdown-item:last-child {
            border-bottom: none;
        }

        .row.text-center {
            text-align: left !important;
        }

        .row.text-center .col-4 {
            width: 100%;
        }

        .row.mb-3 .col-sm-4,
        .row.mb-3 .col-sm-8 {
            width: 100%;
        }

        .row.mb-3 .col-sm-4 {
            margin-bottom: 4px;
        }
    }

    @@media (max-width: 576px) {
        .details-container {
            padding: 12px;
        }

        .page-header {
            padding: 12px;
        }

        .page-header h4 {
            font-size: 1.1rem;
        }

        .page-header p {
            display: none;
        }

        .btn {
            font-size: 0.85rem;
            padding: 8px 14px;
        }

        .btn-sm {
            font-size: 0.8rem;
            padding: 6px 12px;
        }

        .card-header {
            padding: 12px 16px;
        }

        .card-header h5 {
            font-size: 1rem;
        }

        .card-body {
            padding: 12px;
        }

        h2 {
            font-size: 1.25rem !important;
        }

        h4 {
            font-size: 1.1rem !important;
        }

        h5 {
            font-size: 1rem !important;
        }

        h6 {
            font-size: 0.9rem !important;
        }

        .modal-header,
        .modal-body,
        .modal-footer {
            padding: 16px;
        }
    }

    .fa-spin {
        animation: fa-spin 1s infinite linear;
    }

    @@keyframes fa-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
